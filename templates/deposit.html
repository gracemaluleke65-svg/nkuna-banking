{% extends "base.html" %}

{% block title %}Deposit Funds | Nkuna Banking{% endblock %}

{% block head %}
<style>
    .deposit-card {
        background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        border-radius: 24px;
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 20px 60px rgba(0, 102, 204, 0.1);
        overflow: hidden;
        position: relative;
    }
    
    .deposit-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 5px;
        background: linear-gradient(135deg, #0066CC 0%, #0047AB 100%);
    }
    
    .deposit-header {
        background: linear-gradient(135deg, #0066CC 0%, #0047AB 100%);
        color: white;
        padding: 30px;
        text-align: center;
        border-radius: 0 0 40px 40px;
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
    }
    
    .deposit-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    }
    
    .deposit-icon {
        width: 80px;
        height: 80px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        font-size: 32px;
    }
    
    .amount-input-wrapper {
        position: relative;
        margin: 30px 0;
    }
    
    .currency-symbol {
        position: absolute;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 24px;
        font-weight: 700;
        color: #0066CC;
        z-index: 10;
    }
    
    .amount-input {
        width: 100%;
        padding: 25px 20px 25px 60px;
        font-size: 32px;
        font-weight: 700;
        border: 3px solid #e2e8f0;
        border-radius: 16px;
        text-align: center;
        transition: all 0.3s ease;
        font-family: 'Poppins', sans-serif;
        background: white;
    }
    
    .amount-input:focus {
        border-color: #0066CC;
        box-shadow: 0 0 0 4px rgba(0, 102, 204, 0.1);
        outline: none;
        transform: translateY(-2px);
    }
    
    .quick-amount-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin: 30px 0;
    }
    
    @media (min-width: 768px) {
        .quick-amount-grid {
            grid-template-columns: repeat(4, 1fr);
        }
    }
    
    .quick-amount-btn {
        padding: 15px;
        border: 2px solid #e2e8f0;
        border-radius: 12px;
        background: white;
        font-weight: 600;
        color: #4a5568;
        transition: all 0.3s ease;
        cursor: pointer;
        font-size: 1.1rem;
    }
    
    .quick-amount-btn:hover {
        border-color: #0066CC;
        background: rgba(0, 102, 204, 0.05);
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 102, 204, 0.1);
    }
    
    .quick-amount-btn.active {
        border-color: #0066CC;
        background: linear-gradient(135deg, #0066CC 0%, #0047AB 100%);
        color: white;
        box-shadow: 0 8px 20px rgba(0, 102, 204, 0.2);
    }
    
    .summary-card {
        background: linear-gradient(135deg, #f8fafc 0%, #edf2f7 100%);
        border-radius: 16px;
        padding: 25px;
        border: 2px solid #e2e8f0;
        margin: 30px 0;
    }
    
    .summary-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .summary-row:last-child {
        border-bottom: none;
        font-weight: 700;
        font-size: 1.2rem;
    }
    
    .summary-row .label {
        color: #4a5568;
    }
    
    .summary-row .value {
        font-weight: 600;
        color: #2d3748;
    }
    
    .deposit-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 40px;
    }
    
    .info-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
    }
    
    .info-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        border-color: #0066CC;
    }
    
    .info-icon {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #0066CC 0%, #0047AB 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
        margin-bottom: 15px;
    }
    
    .demo-notice {
        background: linear-gradient(135deg, #FFEAA7 0%, #FDCB6E 100%);
        border-radius: 12px;
        padding: 20px;
        margin: 30px 0;
        border-left: 5px solid #E17055;
        position: relative;
        overflow: hidden;
    }
    
    .demo-notice::before {
        content: 'DEMO';
        position: absolute;
        top: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.1);
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 700;
        color: rgba(0, 0, 0, 0.6);
    }
    
    .input-error {
        border-color: #e74c3c !important;
        animation: shake 0.5s;
    }
    
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }
    
    .error-message {
        color: #e74c3c;
        font-size: 0.9rem;
        margin-top: 5px;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .submit-btn {
        background: linear-gradient(135deg, #0066CC 0%, #0047AB 100%);
        border: none;
        color: white;
        padding: 18px 40px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 1.1rem;
        width: 100%;
        transition: all 0.3s ease;
        box-shadow: 0 8px 25px rgba(0, 102, 204, 0.3);
        position: relative;
        overflow: hidden;
    }
    
    .submit-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 30px rgba(0, 102, 204, 0.4);
    }
    
    .submit-btn:active {
        transform: translateY(0);
    }
    
    .submit-btn::after {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: 0.5s;
    }
    
    .submit-btn:hover::after {
        left: 100%;
    }
    
    .submit-btn:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none !important;
        box-shadow: none !important;
    }
    
    .limits-display {
        display: flex;
        gap: 15px;
        margin: 20px 0;
        flex-wrap: wrap;
    }
    
    .limit-badge {
        background: rgba(0, 102, 204, 0.1);
        border: 2px solid rgba(0, 102, 204, 0.2);
        border-radius: 20px;
        padding: 8px 16px;
        font-weight: 600;
        color: #0066CC;
        display: flex;
        align-items: center;
        gap: 8px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Demo Notice -->
            <div class="demo-notice">
                <div class="d-flex align-items-start">
                    <i class="fas fa-exclamation-triangle fa-2x me-3" style="color: #E17055;"></i>
                    <div>
                        <h5 class="mb-2">This is a Demonstration Application</h5>
                        <p class="mb-0"><strong>NO REAL MONEY</strong> is involved. This deposit simulation is for educational and portfolio demonstration purposes only. No actual funds will be transferred.</p>
                    </div>
                </div>
            </div>

            <!-- Deposit Card -->
            <div class="deposit-card">
                <!-- Header -->
                <div class="deposit-header">
                    <div class="deposit-icon">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <h1 class="h2 mb-2">Deposit Funds</h1>
                    <p class="mb-0 opacity-75">Add simulated funds to your demonstration account</p>
                </div>

                <!-- Deposit Form -->
                <div class="p-4 p-md-5">
                    <form method="POST" action="{{ url_for('user.deposit') }}" id="depositForm">
                        {{ form.hidden_tag() }}
                        
                        <!-- Limits Display -->
                        <div class="limits-display justify-content-center">
                            <div class="limit-badge">
                                <i class="fas fa-arrow-up"></i>
                                Max: {{ format_currency(config.MAX_DEPOSIT) }}
                            </div>
                            <div class="limit-badge">
                                <i class="fas fa-arrow-down"></i>
                                Min: {{ format_currency(config.MIN_DEPOSIT) }}
                            </div>
                            <div class="limit-badge">
                                <i class="fas fa-undo"></i>
                                Undo: {{ config.UNDO_MINUTES }} minutes
                            </div>
                        </div>

                        <!-- Amount Input -->
                        <div class="amount-input-wrapper">
                            <span class="currency-symbol">R</span>
                            {{ form.amount(class="amount-input", id="amountInput", placeholder="0.00", min=config.MIN_DEPOSIT, max=config.MAX_DEPOSIT, step="0.01", required=true) }}
                            
                            {% if form.amount.errors %}
                                <div class="error-message mt-2">
                                    <i class="fas fa-exclamation-circle"></i>
                                    {{ form.amount.errors[0] }}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Quick Amount Buttons -->
                        <div class="quick-amount-grid">
                            <button type="button" class="quick-amount-btn" data-amount="100">
                                R 100
                            </button>
                            <button type="button" class="quick-amount-btn" data-amount="1000">
                                R 1,000
                            </button>
                            <button type="button" class="quick-amount-btn" data-amount="5000">
                                R 5,000
                            </button>
                            <button type="button" class="quick-amount-btn" data-amount="10000">
                                R 10,000
                            </button>
                            <button type="button" class="quick-amount-btn" data-amount="25000">
                                R 25,000
                            </button>
                            <button type="button" class="quick-amount-btn" data-amount="50000">
                                R 50,000
                            </button>
                            <button type="button" class="quick-amount-btn" data-amount="{{ config.MAX_DEPOSIT }}">
                                Max ({{ format_currency(config.MAX_DEPOSIT).replace('R', 'R ') }})
                            </button>
                            <button type="button" class="quick-amount-btn" data-amount="{{ config.MIN_DEPOSIT }}">
                                Min ({{ format_currency(config.MIN_DEPOSIT).replace('R', 'R ') }})
                            </button>
                        </div>

                        <!-- Summary Card -->
                        <div class="summary-card">
                            <h5 class="mb-4 text-center">Transaction Summary</h5>
                            <div class="summary-row">
                                <span class="label">Current Balance</span>
                                <span class="value" id="currentBalance">{{ format_currency(current_user.balance) }}</span>
                            </div>
                            <div class="summary-row">
                                <span class="label">Deposit Amount</span>
                                <span class="value text-primary" id="depositAmountDisplay">R 0.00</span>
                            </div>
                            <div class="summary-row">
                                <span class="label">Processing Fee</span>
                                <span class="value text-success">R 0.00 (FREE)</span>
                            </div>
                            <div class="summary-row">
                                <span class="label">New Balance</span>
                                <span class="value text-success fw-bold" id="newBalanceDisplay">{{ format_currency(current_user.balance) }}</span>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="submit-btn" id="submitBtn">
                            <i class="fas fa-check-circle me-2"></i>
                            Confirm Deposit
                        </button>
                    </form>

                    <!-- Deposit Information -->
                    <div class="deposit-info-grid">
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <h6>Instant Processing</h6>
                            <p class="small text-muted mb-0">Funds are available immediately in your account</p>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h6>Secure Transaction</h6>
                            <p class="small text-muted mb-0">Bank-level encryption for all transactions</p>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-undo"></i>
                            </div>
                            <h6>{{ config.UNDO_MINUTES }}-Minute Undo</h6>
                            <p class="small text-muted mb-0">Change your mind? Reverse within {{ config.UNDO_MINUTES }} minutes</p>
                        </div>
                        
                        <div class="info-card">
                            <div class="info-icon">
                                <i class="fas fa-percentage"></i>
                            </div>
                            <h6>No Fees</h6>
                            <p class="small text-muted mb-0">Deposits are completely free of charge</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const amountInput = document.getElementById('amountInput');
        const depositAmountDisplay = document.getElementById('depositAmountDisplay');
        const newBalanceDisplay = document.getElementById('newBalanceDisplay');
        const currentBalance = parseFloat('{{ current_user.balance }}');
        const submitBtn = document.getElementById('submitBtn');
        const quickAmountBtns = document.querySelectorAll('.quick-amount-btn');
        
        // Format currency with R symbol
        function formatCurrency(amount) {
            return 'R ' + parseFloat(amount).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }
        
        // Format input for display
        function formatInput(value) {
            return value.replace(/[^\d.]/g, '');
        }
        
        // Update summary display
        function updateSummary() {
            let depositAmount = parseFloat(amountInput.value) || 0;
            
            // Validate against min/max
            const minAmount = parseFloat('{{ config.MIN_DEPOSIT }}');
            const maxAmount = parseFloat('{{ config.MAX_DEPOSIT }}');
            
            if (depositAmount < minAmount) {
                amountInput.classList.add('input-error');
                depositAmount = minAmount;
            } else if (depositAmount > maxAmount) {
                amountInput.classList.add('input-error');
                depositAmount = maxAmount;
            } else {
                amountInput.classList.remove('input-error');
            }
            
            // Update displays
            depositAmountDisplay.textContent = formatCurrency(depositAmount);
            const newBalance = currentBalance + depositAmount;
            newBalanceDisplay.textContent = formatCurrency(newBalance);
            
            // Enable/disable submit button based on validation
            if (depositAmount >= minAmount && depositAmount <= maxAmount && depositAmount > 0) {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-check-circle me-2"></i> Confirm Deposit';
            } else {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-exclamation-circle me-2"></i> Enter Valid Amount';
            }
        }
        
        // Quick amount button handlers
        quickAmountBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const amount = this.getAttribute('data-amount');
                
                // Remove active class from all buttons
                quickAmountBtns.forEach(b => b.classList.remove('active'));
                
                // Add active class to clicked button
                this.classList.add('active');
                
                // Set input value
                amountInput.value = amount;
                amountInput.focus();
                
                // Update summary
                updateSummary();
            });
        });
        
        // Real-time input validation
        amountInput.addEventListener('input', function() {
            // Format input
            this.value = formatInput(this.value);
            
            // Remove active class from all quick amount buttons
            quickAmountBtns.forEach(b => b.classList.remove('active'));
            
            // Update summary
            updateSummary();
        });
        
        // Form submission
        document.getElementById('depositForm').addEventListener('submit', function(e) {
            const depositAmount = parseFloat(amountInput.value) || 0;
            const minAmount = parseFloat('{{ config.MIN_DEPOSIT }}');
            const maxAmount = parseFloat('{{ config.MAX_DEPOSIT }}');
            
            if (depositAmount < minAmount || depositAmount > maxAmount) {
                e.preventDefault();
                amountInput.classList.add('input-error');
                
                // Show error animation
                amountInput.style.animation = 'none';
                setTimeout(() => {
                    amountInput.style.animation = 'shake 0.5s';
                }, 10);
                
                // Update button text
                submitBtn.innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i> Invalid Amount';
                setTimeout(() => {
                    submitBtn.innerHTML = '<i class="fas fa-check-circle me-2"></i> Confirm Deposit';
                }, 2000);
            } else {
                // Change button to loading state
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Processing...';
            }
        });
        
        // Initialize summary display
        updateSummary();
        
        // Prevent spaces in input (for safety)
        amountInput.addEventListener('keydown', function(e) {
            if (e.key === ' ') {
                e.preventDefault();
            }
        });
        
        // Handle paste event to clean data
        amountInput.addEventListener('paste', function(e) {
            e.preventDefault();
            const pastedText = (e.clipboardData || window.clipboardData).getData('text');
            const cleaned = pastedText.replace(/[^\d.]/g, '');
            this.value = cleaned;
            updateSummary();
        });
        
        // Auto-focus amount input
        setTimeout(() => {
            amountInput.focus();
        }, 300);
    });
</script>
{% endblock %}